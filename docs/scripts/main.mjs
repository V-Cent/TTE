var e=class e{isNavigationLocked;currentActiveSearchType;addPageChangeEventCallback;helperObj;searchBoxSelector="#nav-bar__searchbox";searchInputSelector="#nav-bar__search--input";searchHrSelector="#nav-bar__search--hr";static HARDCODED_FILTERS=["TALES OF","T","TO"];static MAX_TECH_RESULTS=12;constructor(e,t){this.isNavigationLocked=!1,this.currentActiveSearchType=null,this.addPageChangeEventCallback=e,this.helperObj=t,this.handleSearchBoxClick=this.handleSearchBoxClick.bind(this),this.handleInputKeyUp=this.handleInputKeyUp.bind(this),this.handleInputFocusIn=this.handleInputFocusIn.bind(this),this.handleSearchBoxFocusOut=this.handleSearchBoxFocusOut.bind(this)}initializeSearchIcons(){let e=document.querySelector(this.searchBoxSelector);if(!e)return;e.addEventListener("click",this.handleSearchBoxClick);let t=document.querySelector(this.searchInputSelector);t&&(t.addEventListener("keyup",this.handleInputKeyUp),t.addEventListener("focusin",this.handleInputFocusIn)),e.targetParam="search";let n=document.querySelector("#nav-bar__games--icon");n?.addEventListener("click",this.performGamesSearch.bind(this)),e.addEventListener("focusout",this.handleSearchBoxFocusOut)}initializeOnboardingIcon(){let e=document.querySelector("#content__home__onboarding--icon");e?.addEventListener("click",this.performGamesSearch.bind(this))}handleSearchBoxClick(e){if(this.isNavigationLocked)return;let t=e.currentTarget;if(!t||!(t instanceof HTMLElement))return;let n=t.targetParam;n&&(this.currentActiveSearchType=n,this.displaySearchBox("#nav-bar__search"))}displaySearchBox(e){if(this.isNavigationLocked)return;let t=document.querySelector(e);if(!t)return;t.removeEventListener("click",this.handleSearchBoxClick);let n=`${e}box`,o=`${e}--input`,i=document.querySelector(n),r=document.querySelector(o);if(!i)return;let{clientWidth:s}=document.body,l="search"===this.currentActiveSearchType&&s>=480?400:280;i.style.width=`${l}px`,"search"===this.currentActiveSearchType?r?.focus():i.focus()}handleSearchBoxFocusOut(e){let t=document.querySelector("#nav-bar__search");console.log("focusing out"),t&&(console.log("focusing out"),e.stopPropagation(),e.relatedTarget instanceof Node&&t.contains(e.relatedTarget)||this.clearSearchResults())}handleInputKeyUp(){this.filterSearchResults()}handleInputFocusIn(){this.filterSearchResults()}clearSearchResults(){let e=document.querySelector(this.searchBoxSelector);if(!e)return;for(let t of(this.isNavigationLocked=!0,Array.from(e.getElementsByClassName("button__redirect")).filter(e=>e instanceof HTMLElement)))t.style.display="none";let t=document.querySelector(this.searchHrSelector);t&&(t.style.display="none"),e.addEventListener("click",this.handleSearchBoxClick),this.isNavigationLocked=!1}async filterSearchResults(){let t="#nav-bar__search";document.querySelector(".nav-bar__search--results")||await this.populateSearchResults();let n=document.querySelector(`${t}--input`);if(!n)return;let o=n.value.toUpperCase().trim(),i=o.split(" "),r=document.querySelector(`${t}box`);if(!r)return;let s=Array.from(r.getElementsByClassName("button__redirect")).filter(e=>e instanceof HTMLElement),l=0;for(let t of s)if(this.shouldShowSearchResult(t,i,o)){let n=e.HARDCODED_FILTERS.some(e=>e===o||e.includes(o));if(n&&"game"===t.dataset.tag){t.style.display="block";continue}if(n){t.style.display="none";continue}let i=l<e.MAX_TECH_RESULTS||"game"===t.dataset.tag;t.style.display=i?"block":"none",i&&l++}else t.style.display="none";this.updateSearchSeparator(l,o)}shouldShowSearchResult(e,t,n){if(0===n.length)return!1;let o=[e.textContent??e.innerText??"",e.dataset.section??"",e.dataset.document??""].join(" ").toUpperCase();return t.every(e=>o.includes(e))}updateSearchSeparator(t,n){let o=document.querySelector(this.searchHrSelector);if(!o)return;let i=e.HARDCODED_FILTERS.some(e=>e===n||e.includes(n)),r=n.length>0&&(t>0||i);o.style.display=r?"block":"none"}performGamesSearch(){let e=document.querySelector(this.searchBoxSelector);if(!e)return;for(let t of Array.from(e.getElementsByClassName("button__redirect")).filter(e=>e instanceof HTMLElement))t.style.display="none";let t=document.querySelector(this.searchHrSelector);t&&(t.style.display="none"),this.isNavigationLocked=!1;let n=document.querySelector(this.searchInputSelector);n&&(n.value="Tales of",n.focus())}async populateSearchResults(){let e=document.querySelector(this.searchBoxSelector);if(e)try{let{cachedSearchResultsHTML:t}=await import("./searchHTML-CRXw90TV.mjs"),n=await this.helperObj.decompress(t);for(let t of(e.insertAdjacentHTML("beforeend",'<hr id="nav-bar__search--hr" tabindex="0" style="display: none;">'+n),document.querySelectorAll("a.nav-bar__search--results")))t instanceof HTMLElement&&this.addPageChangeEventCallback(t);e.focus()}catch(e){console.error("Failed to load search results:",e)}}revealElementById(e){let t=document.getElementById(e);if(!t){let n=this.findH2SectionIndex(e);if(-1===n)return;let o=document.querySelectorAll(".content__selectorbox--item");o[n]?.click(),t=document.getElementById(e)}if(!t)return;let n=this.getHiddenElementClasses(t);if(n)for(let e of n)this.revealElementsByClassName(e)}findH2SectionIndex(e){let t=this.helperObj.h2Collection;return t?t.findIndex(t=>t.content.includes(`id="${e}"`)||t.id===e):-1}getHiddenElementClasses(e){if("H4"===e.tagName&&e.dataset.open)return e.dataset.open.split(" ");let t=e.parentNode;if(t?.className.includes("content__")){let e=t.firstElementChild;if(e?.dataset.open)return e.dataset.open.split(" ")}let n=t?.parentNode;if(n){let e=n.firstElementChild;if(e?.dataset.open)return e.dataset.open.split(" ")}return null}revealElementsByClassName(e){for(let t of document.getElementsByClassName(e))t instanceof HTMLElement&&t.hidden&&(t.hidden=!1,this.updateExpandIcon(t))}updateExpandIcon(e){let t=(e=>{let t=e.parentNode;if(t?.className.includes("content__"))return t.firstElementChild?.children[0]??null;let n=t?.parentNode;return n?.firstElementChild?.children[0]??null})(e);t?.innerHTML==="expand_circle_down"&&(t.innerHTML="expand_circle_up")}},t=class e{headings;ticking;helperObj;static VIEWPORT_THRESHOLD_RATIO=.25;static MIN_THRESHOLD_PIXELS=150;static TOC_OFFSET_PIXELS=10;static MOBILE_TOC_WIDTH_BREAKPOINT=480;static MOBILE_TOC_WIDTH_LARGE=360;static MOBILE_TOC_WIDTH_SMALL=300;constructor(e){this.headings=[],this.ticking=!1,this.helperObj=e,document.addEventListener("scroll",this.handleScroll.bind(this),{passive:!0})}handleScroll(){!this.ticking&&this.helperObj.inTechPage&&(window.requestAnimationFrame(()=>{this.highlightTOC(),this.ticking=!1}),this.ticking=!0)}clearHeadings(){this.headings.length=0}createTOC(e){let t=this.initializeTOCElements();if(!t)return;let{tocBorder:n,selector:o,toc:i,tocMobile:r}=t;n.style.height=`calc(100% - ${o.offsetTop+150}px)`;let s="<p>ON THIS SECTION</p><hr>";i.innerHTML=s,r.innerHTML=s,this.populateHeadings();let l=this.generateTOCLinks(e);i.innerHTML=s.concat(l),r.innerHTML=s.concat(l)}initializeTOCElements(){let e=document.getElementById("content__tocborder"),t=document.getElementById("content__selector"),n=document.getElementById("content__toc"),o=document.getElementById("content__tocmobile");if(!e){if(!this.createTOCElements())return null;e=document.getElementById("content__tocborder"),t=document.getElementById("content__selector"),n=document.getElementById("content__toc"),o=document.getElementById("content__tocmobile")}return e&&t&&n&&o?{tocBorder:e,selector:t,toc:n,tocMobile:o}:null}createTOCElements(){if(!document.querySelector(".content__selectorbox--item.selected"))return null;let t=document.getElementById("content"),n=document.getElementById("content__selector");if(!t||!n)return null;let o=document.createElement("div");o.id="content__tocborder",t.appendChild(o);let i=document.createElement("div");return i.id="content__toc",o.appendChild(i),o.style.top=`${n.offsetTop+t.offsetTop+e.TOC_OFFSET_PIXELS}px`,this.createMobileTOCElements(),this.setupTOCEventListeners(),{tocBorder:o,selector:n,content:t}}createMobileTOCElements(){let e=document.getElementById("section-container__div");if(!e)return;let t=document.createElement("span");t.className="material-symbols-rounded",t.id="content__tocicon",t.innerHTML="menu_book",t.style.display="none",e.appendChild(t);let n=document.createElement("div");n.id="content__tocicon--box",n.tabIndex=0,n.style.width="0px",e.appendChild(n);let o=document.createElement("div");o.id="content__tocmobile",n.appendChild(o),this.helperObj.dragScrollElement(`#${n.id}`,1),this.helperObj.dragScrollElement("#content__toc",1)}setupTOCEventListeners(){let e=document.getElementById("content__tocicon"),t=document.getElementById("content__tocicon--box");e&&t&&(e.addEventListener("click",()=>this.handleTOCIconClick()),t.addEventListener("focusout",e=>{this.handleTOCBoxFocusOut(e)}))}handleTOCIconClick(){let t=document.getElementById("content__tocicon--box");if(!t)return;let n=document.body.clientWidth>=e.MOBILE_TOC_WIDTH_BREAKPOINT?e.MOBILE_TOC_WIDTH_LARGE:e.MOBILE_TOC_WIDTH_SMALL;Object.assign(t.style,{width:`${n}px`,display:"block"}),t.className="fadein",t.focus()}handleTOCBoxFocusOut(e){let t=document.getElementById("content__tocicon--box");t&&(e.stopPropagation(),t.className="fadeout")}populateHeadings(){this.headings.length=0;let e=document.querySelectorAll("#content__currenth2 h3"),t=document.querySelectorAll("#content__currenth2 h4");for(let t of e)this.headings.push({name:t.textContent??"",clientY:t.getBoundingClientRect().top,isH3:!0,obj:t,id:t.id});for(let e of t)this.headings.push({name:e.textContent??"",clientY:e.getBoundingClientRect().top,isH3:!1,obj:e,id:e.id});this.headings.sort((e,t)=>e.clientY-t.clientY)}generateTOCLinks(e){let t="";for(let n=0;n<this.headings.length;n++){let o=this.headings[n],i=o.isH3?"":" content__toc--search-h4",r=`content__toc--search button__redirect${i}`;t+=`<div data-document="${e}" data-section="${this.helperObj.currentSection}" data-redirect="#${o.id}" class="${r}" style="display: block;">${o.name}</div>`}return t}highlightTOC(){let{currentH3:e,currentH3Index:t,nextH3Index:n}=this.findCurrentH3();this.updateTOCHighlighting(e),this.updateH4Visibility(t,n)}findCurrentH3(){let t=null,n=0,o=0;for(let i=0;i<this.headings.length;i++){let r=this.headings[i];if(r.isH3)if(r.obj.getBoundingClientRect().top<=Math.max(window.innerHeight*e.VIEWPORT_THRESHOLD_RATIO,e.MIN_THRESHOLD_PIXELS)||null===t)t=r,n=i;else{o=i;break}}return{currentH3:t,currentH3Index:n,nextH3Index:o}}updateTOCHighlighting(e){if(e){for(let e of document.querySelectorAll(".content__toc--search.active"))e.classList.remove("active");for(let t of document.querySelectorAll(`.content__toc--search[data-redirect="#${e.id}"]`))t.classList.add("active")}}updateH4Visibility(e,t){for(let n=0;n<this.headings.length;n++){let o=this.headings[n];if(o.isH3)continue;let i=this.isH4WithinVisibleRange(n,e,t);for(let e of document.querySelectorAll(`.content__toc--search[data-redirect="#${o.id}"]`))i?(e.style.display="block",e.classList.add("active")):(e.style.display="none",e.classList.remove("active"))}}isH4WithinVisibleRange(e,t,n){return e>=t&&e<=n||0===n&&t>0&&e>=t||0===n&&0===t}clearSectionTOC(){for(let e of["content__tocicon","content__tocicon--box"]){let t=document.getElementById(e);t?.remove()}}};let n={yellow:"#f8d959",pink:"#fe796f",teal:"#45c9c9",green:"#58f15b",red:"#e74a41",lavender:"#c8a2b0",blue:"#205aaa"};var o=class{mouseDown;startX;scrollLeft;startY;scrollTop;scrollButton;rootElement;logoElement;rotateFlag;leaveCounter;currentVelocity;chromeVersionRegex=/Chrom(?:e|ium)\/([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)/;versionMap;currentSection;currentDocument;inTechPage;addPageChangeEvent;fileList;h2Collection;constructor(e,t){this.mouseDown=!1,this.startX=0,this.scrollLeft=0,this.startY=0,this.scrollTop=0,this.scrollButton=null,this.rootElement=null,this.logoElement=null,this.rotateFlag=!1,this.leaveCounter=0,this.currentVelocity=0,this.versionMap=new Map,this.currentSection=void 0,this.currentDocument=void 0,this.inTechPage=!1,this.addPageChangeEvent=e,this.fileList=t,this.h2Collection=[]}updateStatus(e,t,n){this.currentDocument=e,this.currentSection=t,this.inTechPage=n,this.versionMap.clear()}logoInit(){let e=document.querySelector("#nav-bar__title");e?.addEventListener("mouseenter",this.startRotateLogo.bind(this)),e?.addEventListener("mouseleave",this.stopRotateLogo.bind(this)),this.logoElement=document.querySelector("#nav-bar__title__logo")}addLogoVelocity(){if(!this.rotateFlag&&0===this.leaveCounter){this.currentVelocity=4,this.leaveCounter=200,requestAnimationFrame(this.rotateLogo.bind(this));return}this.currentVelocity=4,this.leaveCounter=200}startRotateLogo(){this.rotateFlag||0!==this.leaveCounter?(this.rotateFlag=!0,this.leaveCounter=200):(this.rotateFlag=!0,requestAnimationFrame(this.rotateLogo.bind(this)))}stopRotateLogo(){this.rotateFlag=!1}rotateLogo(){if(this.logoElement??=document.querySelector("#nav-bar__title__logo"),!this.logoElement)return;let e=getComputedStyle(this.logoElement).getPropertyValue("transform");if("none"===e)return;let t=e.split("(")[1].split(")")[0].split(","),n=parseFloat(t[0]),o=180/Math.PI*Math.atan2(parseFloat(t[1]),n);this.rotateFlag?this.currentVelocity=Math.min(this.currentVelocity+.06,1.8):this.currentVelocity=Math.max(this.currentVelocity-.03,0),o=o<0?o+360:o;let i=this.currentVelocity+o;if(this.logoElement.style.transform=`rotate(${i}deg)`,this.rotateFlag){this.leaveCounter=200,requestAnimationFrame(this.rotateLogo.bind(this));return}this.leaveCounter--,this.currentVelocity<=0&&(this.leaveCounter=0),this.leaveCounter>0&&requestAnimationFrame(this.rotateLogo.bind(this))}scrollInit(){this.scrollButton=document.querySelector("#scroll__button--to-top"),this.rootElement=document.documentElement,this.scrollButton?.addEventListener("click",this.scrollToTop.bind(this)),window.addEventListener("scroll",this.handleScroll.bind(this))}handleScroll(){if(!this.rootElement)return;let e=this.rootElement.scrollHeight-this.rootElement.clientHeight,t=document.getElementById("content__selectorbox"),n=0;if(t){let e=document.body.getBoundingClientRect();n=Math.max(t.getBoundingClientRect().top-e.top,0)}(this.rootElement.scrollTop-n)/e>.05?this.scrollButton?.classList.add("scroll__button--to-top--show"):this.scrollButton?.classList.remove("scroll__button--to-top--show")}scrollToTop(){let e=document.getElementById("content__selectorbox"),t=0;if(e){let n=document.body.getBoundingClientRect();t=Math.max(e.getBoundingClientRect().top-n.top-20,0)}window.requestAnimationFrame(()=>{let e="smooth";if(navigator.userAgent.includes("Chrome")){let t=navigator.userAgent.match(this.chromeVersionRegex),n=Number(t?.[1]??130);!isNaN(n)&&n<130&&(e="auto")}this.rootElement?.scrollTo({top:t,behavior:e})})}loadTooltip(e,t){if(!e)return;document.getElementsByTagName("tooltip")[0]?.remove();let n=document.createElement("tooltip");n.id="nav-bar__tooltip",n.textContent=t;let o=e.getBoundingClientRect();Object.assign(n.style,{top:`${o.bottom-10}px`,left:`${o.right}px`}),document.body.appendChild(n)}unloadTooltip(){document.getElementsByTagName("tooltip")[0]?.remove()}dragScrollElement(e,t){let n=document.querySelector(e);if(!n)return;let o=e=>e instanceof MouseEvent?{x:e.pageX,y:e.pageY}:{x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY},i=e=>{this.mouseDown=!0;let t=o(e);this.startX=t.x-n.offsetLeft,this.scrollLeft=n.scrollLeft},r=e=>{this.mouseDown=!0;let t=o(e);this.startY=t.y-n.offsetTop,this.scrollTop=n.scrollTop},s=e=>{if(e.stopPropagation(),!this.mouseDown)return;let t=o(e).x-n.offsetLeft-this.startX;n.scrollLeft=this.scrollLeft-t},l=e=>{if(e.stopPropagation(),!this.mouseDown)return;let t=o(e).y-n.offsetTop-this.startY;n.scrollTop=this.scrollTop-t},c=()=>{this.mouseDown=!1},a={passive:!1},d={passive:!0};for(let[e,o,u]of 1===t?[["mousemove",l,a],["mousedown",r,d],["mouseup",c,d],["mouseleave",c,d],["touchmove",l,a],["touchstart",r,d],["touchend",c,d]]:[["mousemove",s,a],["mousedown",i,d],["mouseup",c,d],["mouseleave",c,d],["touchmove",s,a],["touchstart",i,d],["touchend",c,d]])n.addEventListener(e,o,u)}createMediaElement(e,t,n,o,i,r){let s,l=e.createElement("p");if(Object.assign(l.style,{opacity:"1",textAlign:"center"}),"img"===t)Object.assign(s=e.createElement("img"),{alt:r??"",loading:"lazy",src:n});else{Object.assign(s=e.createElement("video"),{preload:"metadata",controls:!0,muted:!0,loop:!0});let t=e.createElement("source");Object.assign(t,{src:n,type:"video/mp4"}),s.appendChild(t)}if(Object.assign(s,{draggable:!1,width:o,height:i}),Object.assign(s.style,{order:"2",width:"80%",height:"auto",maxWidth:"640px",outline:"none",borderRadius:"14px"}),l.appendChild(s),r){let t=e.createElement("u");t.classList.add("content__figure-caption"),Object.assign(t.style,{whiteSpace:"pre"}),t.textContent=` ${r} `,l.appendChild(t)}return l}async asyncRead(e){let t=await this.loadFile(e);return!t||t.length<=1?"":t}async loadFile(e){return new Promise((t,n)=>{let o=new XMLHttpRequest;o.open("GET",e,!0),o.onload=()=>{o.status>=200&&o.status<300?t(o.response):n({status:o.status,statusText:o.statusText})},o.onerror=()=>{n({status:o.status,statusText:o.statusText})},o.send()})}async compress(e){let t=new TextEncoder,n=new Response(new ReadableStream({start(n){n.enqueue(t.encode(e)),n.close()}}).pipeThrough(new CompressionStream("deflate-raw"))),o=await n.arrayBuffer();return"undefined"!=typeof Buffer?Buffer.from(o).toString("base64"):btoa(String.fromCharCode(...new Uint8Array(o)))}async decompress(e){let t;if("undefined"!=typeof Buffer)t=Buffer.from(e,"base64");else{let n=atob(e);t=new Uint8Array(n.length);for(let e=0;e<n.length;e++)t[e]=n.charCodeAt(e)}let n=new Response(new ReadableStream({start(e){e.enqueue(t),e.close()}}).pipeThrough(new DecompressionStream("deflate-raw")));return await n.text()}},i=class e{colorCollection;helperObj;static CHEVRON_UPDATE_DELAY=700;constructor(e){this.colorCollection=n,this.helperObj=e,this.collapseHeadingStyle=this.collapseHeadingStyle.bind(this)}collapseHeadings(){this.helperObj.dragScrollElement("#content__selectorbox",0),this.setupChevrons();let e=document.getElementById("content");null!==e&&(e.style.visibility="visible")}setupChevrons(){let e=this.getChevronElements();if(!e)return;let{chevronBox:t,chevronLeft:n,chevronRight:o,selectorBox:i}=e,r=()=>{let e=i.clientWidth,r=i.scrollWidth;e<r?Object.assign(t.style,{display:"block",left:`${i.getBoundingClientRect().right}px`}):t.style.display="none";let s=i.scrollLeft;n.classList.toggle("active",s>0),o.classList.toggle("active",s<r-e)};r(),this.setupChevronEventListeners(n,o,i,r)}getChevronElements(){let e=document.getElementById("content__mobilechevrons"),t=document.querySelector(".content__mobilechevrons--left"),n=document.querySelector(".content__mobilechevrons--right"),o=document.getElementById("content__selectorbox");return e&&t&&n&&o?{chevronBox:e,chevronLeft:t,chevronRight:n,selectorBox:o}:null}setupChevronEventListeners(e,t,n,o){window.addEventListener("resize",o),e.addEventListener("click",()=>{this.handleChevronClick(n,"left",o)}),t.addEventListener("click",()=>{this.handleChevronClick(n,"right",o)}),n.addEventListener("scroll",o)}handleChevronClick(t,n,o){let i=t.offsetWidth,r="left"===n?Math.max(0,t.scrollLeft-i):Math.min(t.scrollWidth-i,t.scrollLeft+i);t.scrollTo({left:r,behavior:"smooth"}),setTimeout(()=>o(),e.CHEVRON_UPDATE_DELAY)}collapseHeadingStyle(e){let t=e.currentTarget;if(!t||!(t instanceof HTMLElement)||!t.dataset.open)return;let n=t.dataset.open.split(" ");for(let e of n)this.toggleElementsByClassName(e,t,0===n.indexOf(e))}toggleElementsByClassName(e,t,n){for(let o of document.getElementsByClassName(e))o instanceof HTMLElement&&(o.hidden?(o.hidden=!1,this.updateExpandIcon(t,"expand_circle_up")):n&&(o.hidden=!0,this.updateExpandIcon(t,"expand_circle_down")))}updateExpandIcon(e,t){let n=e.children[0];n?.innerHTML!==t&&n&&(n.innerHTML=t)}shareHeadings(){let e=document.location.pathname.substring(1),t=e.split("/");t.length>1&&(e=t[0]);let n=window.location.origin;for(let t of document.querySelectorAll("h3, h4")){let o=t;o.style.cursor="copy",o.addEventListener("click",()=>{let t=`${n}/${e}/${o.id}`;navigator.clipboard.writeText(t).catch(()=>{})})}}},r=class e{helperObj;static TAGGING_COMPUTED_SELECTOR=".tagging-computed";static VERSION_TRIGGER_SELECTOR="[data-tte-version-trigger]";static TODO_TRIGGER_SELECTOR="[data-tte-todo-trigger]";static MEDIA_ICON_SELECTOR="[data-tte-media-icon]";static TABLE_HEADERS_SELECTOR="th";static SPOILER_SELECTOR=".spoiler";constructor(e){this.compileDirectives=this.compileDirectives.bind(this),this.sortTables=this.sortTables.bind(this),this.treatSpoilers=this.treatSpoilers.bind(this),this.helperObj=e}compileEvents(){for(let t of document.querySelectorAll(e.TAGGING_COMPUTED_SELECTOR)){let e=JSON.parse((t.dataset.tags??"{}").replace(/'/g,'"'));e.sections&&this.setupSectionEventListeners(t),e.versions&&this.setupVersionEventListeners(t,e.versions),e.todo&&this.setupTodoEventListeners(t),e.media&&!1===e.forcedmedia&&this.setupMediaEventListeners(t),t.classList.contains("content__redirect")&&this.helperObj.addPageChangeEvent(t)}}setupSectionEventListeners(e){for(let t of e.querySelectorAll('input[name="sections"]'))this.helperObj.addPageChangeEvent(t)}setupVersionEventListeners(t,n){let o=t.querySelector(e.VERSION_TRIGGER_SELECTOR);if(!o)return;let i=`Version: ${n}.`;o.addEventListener("mouseover",()=>{this.helperObj.loadTooltip(o,i)},{passive:!0}),o.addEventListener("mouseleave",()=>{this.helperObj.unloadTooltip()},{passive:!0})}setupTodoEventListeners(t){let n=t.querySelector(e.TODO_TRIGGER_SELECTOR);n&&(n.addEventListener("mouseover",()=>{this.helperObj.loadTooltip(n,"This section needs work, is not confirmed or needs testing.")},{passive:!0}),n.addEventListener("mouseleave",()=>{this.helperObj.unloadTooltip()},{passive:!0}))}setupMediaEventListeners(t){let n=t.querySelector(e.MEDIA_ICON_SELECTOR);if(!n)return;let o=n.dataset.mediaSrc,i=n.dataset.mediaType,r=n.dataset.mediaCaption;o&&i&&n.addEventListener("click",()=>{this.handleMediaIconClick(t,o,i,r)},{passive:!0})}handleMediaIconClick(e,t,n,o){let i=document.querySelector(`p[data-media="${t}"]`);if(i)return void i.remove();let r=this.helperObj.createMediaElement(document,n,t,640,480,o);r.dataset.media=t,e.parentNode?.insertBefore(r,e.nextSibling)}compileDirectives(){this.compileEvents(),this.sortTables(),this.treatSpoilers()}sortTables(){for(let t of document.querySelectorAll(e.TABLE_HEADERS_SELECTOR)){let e=t;e.innerHTML+='<span class="material-symbols-rounded">swap_vert</span>',e.addEventListener("click",()=>{this.handleTableHeaderClick(e)})}}handleTableHeaderClick(e){let t=e.closest("table"),n=t?.querySelector("tbody")??null;if(!n)return;let o=Array.from(n.querySelectorAll("tr")),i=Array.from(e.parentNode?.children??[]).indexOf(e),r="true"!==e.dataset.asc,s=(e,t)=>e.children[t]?.textContent?.trim()??"";for(let e of o.toSorted((e,t)=>{let n=s(r?e:t,i),o=s(r?t:e,i);if(""===n||""===o)return n.localeCompare(o);let l=Number(n),c=Number(o);return isNaN(l)||isNaN(c)?n.localeCompare(o):l-c}))n.appendChild(e);e.dataset.asc=r.toString()}treatSpoilers(){for(let t of document.querySelectorAll(e.SPOILER_SELECTOR))t.addEventListener("click",e=>{let t=e.currentTarget;t instanceof HTMLElement&&(t.style.background="transparent")},{passive:!0})}};let s=[{document:"./README",section:"README",dim:"N/A",ref:"readme"},{document:"./STYLING",section:"Document Styling",dim:"N/A",ref:"styling"},{document:"./CONTRIBUTING",section:"How to Contribute",dim:"N/A",ref:"contributing"},{document:"TODPS2",section:"Tales of Destiny",dim:"2D",ref:"todps2"},{document:"TODPS2-C",section:"Tales of Destiny",dim:"2D",ref:"todps2-c"},{document:"TODPS2-B",section:"Tales of Destiny",dim:"2D",ref:"todps2-b"},{document:"TOL",section:"Tales of Legendia",dim:"2D",ref:"tol"},{document:"TOA",section:"Tales of Arise",dim:"3D",ref:"toa"},{document:"TOV",section:"Tales of Vesperia",dim:"3D",ref:"tov"},{document:"TOTA",section:"Tales of the Abyss",dim:"3D",ref:"tota"},{document:"TOX2",section:"Tales of Xillia 2",dim:"3D",ref:"tox2"},{document:"TOZ",section:"Tales of Zestiria",dim:"3D",ref:"toz"},{document:"HOME",section:"HOME",dim:"N/A",ref:""}],l={NAV_BAR:"#nav-bar",SEARCH_INPUT:"#nav-bar__search--input",CONTENT_SELECTOR:"#content__selector",META_DESCRIPTION:'meta[name="description"]',H1:"h1",TOC_SEARCH:".content__toc--search",SELECTOR_ITEM:".content__selectorbox--item",CONTENT_COLLAPSE:".content__collapse",CONTENT_REDIRECT:"span.content__redirect",SHOWCASE_PLAY:".content__home__showcase-item--play",SHOWCASE_VIDEO:".content__home__showcase-item--video"},c={MIN_HEIGHT_STANDARD:"600px",MIN_HEIGHT_TECH:"100vh",REDIRECT_DELAY:250,VIDEO_FADE_DELAY:50,VIDEO_REMOVE_DELAY:500},a={helper:new o(h,s),headings:{},directives:{},search:{},toc:{}};a.headings=new i(a.helper),a.directives=new r(a.helper),a.search=new e(h,a.helper),a.toc=new t(a.helper);let d={parsedDocuments:new Map,currentDocument:"",katexLoaded:!1,pageContent:""};function u(){(function(){for(let e of["div#nav-bar__title","p.footer-container__help--links","img#title-text__img"])for(let t of document.querySelectorAll(e))h(t)})(),a.search.initializeSearchIcons(),a.search.initializeOnboardingIcon(),a.helper.scrollInit(),a.helper.logoInit(),window.addEventListener("popstate",e=>{e.preventDefault(),e.stopPropagation(),g(e.state?{...e.state,isPopstate:!0}:{document:"HOME",section:"HOME",pageType:"home",isPopstate:!0})}),function(){let e=document.location.pathname.substring(1);if(!e){let e=E({document:"HOME",section:"HOME"});e.isPopstate=!0,g(e);return}let t=e.split("/"),n=t[0]||"",o=t[1]||"",i=s.find(e=>e.ref===n);if(i){let t=E({document:i.document,section:i.section,redirect:o?`#${o}`:void 0});t.isPopstate=!0,g(t),window.history.replaceState(t,i.section,e)}else g(E({document:"HOME",section:"HOME"}))}()}function h(e){p(),e.removeEventListener("click",m),e.addEventListener("click",m)}function m(e){e.preventDefault(),e.stopPropagation(),p();let t=e.currentTarget;t instanceof HTMLElement&&g(E(t.dataset))}function p(){let e=document.querySelector(l.SEARCH_INPUT);e&&(document.activeElement?.blur(),e.blur())}function E(e){var t;let n=e.document||"";return{document:n,section:e.section||"",redirect:e.redirect,pageType:"HOME"===(t=n)?"home":t.includes("./")?"generic":"tech",isPopstate:!1}}async function g(e){"tech"===e.pageType&&await f(),await _(e),function(e){var t,n;if(d.currentDocument===e.document&&"tech"===e.pageType&&e.redirect){(function(e){if(e.redirect){a.search.revealElementById(e.redirect.substring(1));let t=document.querySelector(e.redirect)??document.querySelector(l.CONTENT_SELECTOR);t?.scrollIntoView({behavior:"smooth"})}else S()})(e),y(e);return}d.currentDocument=e.document,function(e){let t=document.getElementById("content");t&&(t.style.minHeight="tech"===e.pageType?c.MIN_HEIGHT_TECH:c.MIN_HEIGHT_STANDARD,"tech"===e.pageType&&(t.style.visibility="hidden"),a.toc.clearHeadings(),a.toc.clearSectionTOC(),a.helper.updateStatus(e.document,e.section,"tech"===e.pageType),t.innerHTML=d.pageContent,"tech"===e.pageType&&function(){let e=document.querySelector(l.H1);if(!e)return;let t=e.dataset.h2Collection;t&&(e.removeAttribute("data-h2-collection"),a.helper.h2Collection=JSON.parse(t))}())}(e),function(e){let t="tech"===e.pageType?`TTE - ${e.section}`:"Tales Tech Encyclopaedia",n="tech"===e.pageType?`Tales Tech Encyclopaedia (TTE) article on ${e.section}.`:"Tales Tech Encyclopaedia (TTE), is a project that aims to document techniques and mechanics on the games of the 'Tales of Series'.";document.title=t;let o=document.querySelector(l.META_DESCRIPTION);o?.setAttribute("content",n)}(e),y(e),t=e,a.directives.compileDirectives(),a.toc.createTOC(d.currentDocument),v(),a.headings.shareHeadings(),"home"===t.pageType?(function(){for(let e of document.querySelectorAll(l.CONTENT_REDIRECT))h(e)}(),function(){for(let e of document.querySelectorAll(l.SHOWCASE_PLAY))e.addEventListener("click",C)}(),a.search.initializeOnboardingIcon()):"tech"===t.pageType&&(a.headings.collapseHeadings(),function(){for(let e of document.querySelectorAll(l.SELECTOR_ITEM))e.addEventListener("click",L)}(),function(){let e=document.querySelector(l.SELECTOR_ITEM);e?.click()}()),"tech"===(n=e).pageType&&n.redirect&&"NONE"!==n.redirect?setTimeout(()=>{a.search.revealElementById(n.redirect.substring(1));let e=document.querySelector(n.redirect)??document.querySelector(l.CONTENT_SELECTOR);e?.scrollIntoView({behavior:"smooth"})},c.REDIRECT_DELAY):S()}(e)}async function f(){if(!d.katexLoaded)return new Promise(e=>{let t=document.createElement("link");Object.assign(t,{rel:"stylesheet",crossOrigin:"anonymous",href:"styles/katex.min.css"}),t.onload=()=>{d.katexLoaded=!0,e()},document.head.appendChild(t)})}async function _(e){a.search.clearSearchResults(),a.helper.addLogoVelocity(),d.pageContent=await T(e)}async function T(e){let t=e.document;if(d.parsedDocuments.has(t))return d.parsedDocuments.get(t)??"";let n=function(e){switch(e.pageType){case"home":return`./${e.document.toLowerCase()}.html`;case"generic":return`./${e.document}.html`;case"tech":return`./tech/${e.document.toLowerCase()}.html`}}(e),o=await a.helper.asyncRead(n);return d.parsedDocuments.set(t,o),o}function y(e){if(e.isPopstate)return;let t=function(e){switch(e.pageType){case"home":return"/";case"generic":return`/${e.document.toLowerCase()}`;case"tech":{let t=`/${e.document.toLowerCase()}`;return e.redirect&&"NONE"!==e.redirect?`${t}/${e.redirect.substring(1)}`:t}}}(e);window.history.pushState(e,document.title,t)}function S(){document.querySelector(l.NAV_BAR)?.scrollIntoView({behavior:"smooth"})}function C(e){let t=e.currentTarget;t instanceof HTMLElement&&("play_circle"===t.innerHTML?function(e){e.innerHTML="stop_circle";let t=document.createElement("video");Object.assign(t,{src:e.dataset.video||"",className:l.SHOWCASE_VIDEO.substring(1),autoplay:!0,controls:!1,muted:!0,loop:!0}),e.parentElement?.appendChild(t),setTimeout(()=>{t.style.opacity="1"},c.VIDEO_FADE_DELAY)}(t):function(e){let t=e.parentElement?.querySelector(l.SHOWCASE_VIDEO);t?(t.style.opacity="0",setTimeout(()=>{t.remove(),e.innerHTML="play_circle"},c.VIDEO_REMOVE_DELAY)):e.innerHTML="play_circle"}(t))}function v(){for(let e of document.querySelectorAll(l.TOC_SEARCH))h(e)}function L(e){let t=e.currentTarget;t instanceof HTMLElement&&(function(){for(let e of document.querySelectorAll(l.SELECTOR_ITEM))e.className="content__selectorbox--item"}(),t.className="content__selectorbox--item selected",function(e){let t=a.helper.h2Collection.filter(t=>t.id===e.dataset.open),n=document.getElementById("content__currenth2");n&&t.length>0&&(n.innerHTML=t[0].content)}(t),function(){for(let e of document.querySelectorAll(l.CONTENT_COLLAPSE))e.addEventListener("click",a.headings.collapseHeadingStyle)}(),a.directives.compileDirectives(),a.toc.createTOC(d.currentDocument),v(),a.headings.shareHeadings(),a.toc.highlightTOC())}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u();export{h as addPageChangeEvent};